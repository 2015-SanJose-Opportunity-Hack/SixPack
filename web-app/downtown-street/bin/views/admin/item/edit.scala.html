@(title: String, isLoggedIn: Boolean, editItemForm: Form[views.formdata.admin.EditItemForm], categoryList: List[models.Category], departmentList: List[models.Department], tagId: Integer, logText: String, imagePath: String, success: Boolean)

@import views.html.admin._
@import helper._
@import views.html.bootstrap3._


@backend(title, isLoggedIn) {

	<div class="col-md-6">
	<h2><span class="glyphicon glyphicon-th-large"></span> @title <small> | Edit items to the inventory</small></h2>
	<hr>
	@if(success){
		<div class="row">
			<div class="alert alert-success text-center">Item successfully updated.</div>
		</div>	
	}
		@form(routes.AdminController.updateItem(tagId), 'class -> "form-horizontal", 'enctype -> "multipart/form-data"){
	    
	    @number(editItemForm("tagId"),
        	label = "Tag ID",
        	placeholder = "Item Tag ID (required)")
        	
        @text(editItemForm("name"),
        	label = "Name",
        	placeholder = "Item Name (required)")
        	
       	@text(editItemForm("description"),
        	label = "Description",
        	placeholder = "Description if any (optional)")
       	
      	@text(editItemForm("serialNumber"),
        	label = "Serial Number",
        	placeholder = "Serial Number if any (optional)")
        	
       	@price(editItemForm("unitCost"),
        	label = "Unit Cost",
        	placeholder = "Item Unit Cost (required)")
       	
       	@number(editItemForm("quantity"),
        	label = "Quantity",
        	placeholder = "Item Quantity (default is 1)")
        	
       	@text(editItemForm("location"),
        	label = "Location",
        	placeholder = "Item Location (optional)")
        	
       		
      	  <div class="form-group @if(editItemForm("categoryId").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label" for="@editItemForm("categoryId").id">Category</label>
		    <div class="col-sm-9">
		      <select
		        class="form-control"
		        id="@editItemForm("categoryId").id"
		        name="@editItemForm("categoryId").name"
		        >
		        @for(category <- categoryList) {
		          <option id="@category.getCategoryName()" value="@category.getId()" @if(editItemForm("categoryId").value.toString() == (category.getId().toString())){selected }>@category.getCategoryName()</option>
		       
		        }
		        
		      </select>
		      
		      <span class="help-block">@{editItemForm("categoryId").error.map { error => error.message }}</span>
		    </div>
		  </div>
		  
		  <div class="form-group @if(editItemForm("departmentId").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label" for="@editItemForm("departmentId").id" >Department</label>
		    <div class="col-sm-9">
		      <select
		        class="form-control"
		        id="@editItemForm("departmentId").id"
		        name="@editItemForm("departmentId").name"
		        >
		        @for(department <- departmentList) {
		          <option id="@department.getName()" value="@department.getId()" @if(editItemForm("departmentId").value.toString() == (department.getId().toString())){selected }>@department.getName()</option>
		        }
		      </select>
		      
		      <span class="help-block">@{editItemForm("departmentId").error.map { error => error.message }}</span>
		    </div>
		  </div>
		  
		  <div class="form-group @if(editItemForm("purchaseDate").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label">Purchase Date</label>
		    <div class="col-sm-9">
		    	<input 
		    		id="editItemForm("purchaseDate").id" 
		    		type="date" 
		    		value="@editItemForm("purchaseDate").value"
		    		class="form-control"
		    		name="@editItemForm("purchaseDate").name"
		    		placeholder="Leave blank for current date and time"
		    	/>
		    </div>
		  </div>
		  
		   @number(editItemForm("disposeQuantity"),
        	label = "Dispose Quantity",
        	placeholder = "Number of items disposed if any",
        	isMinZero = true
        	)
		  
		  <div class="form-group @if(editItemForm("disposalDate").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label">Disposal Date</label>
		    <div class="col-sm-9">
		    	<input 
		    		id="editItemForm("disposalDate").id" 
		    		type="date" 
		    		value="@editItemForm("disposalDate").value"
		    		class="form-control"
		    		name="@editItemForm("disposalDate").name"
		    		placeholder="Leave blank for current date and time"
		    	/>
		    </div>
		  </div>
		
       	@text(editItemForm("otherInformation"),
        	label = "Other Information",
        	placeholder = "Other information not mentioned in the form (optional)")
        	
       	<div class="form-group @if(editItemForm("isApproved").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label" for="@editItemForm("isApproved").id">Approval Status</label>
		    <div class="col-sm-9">
		      <select
		        class="form-control"
		        id="@editItemForm("isApproved").id"
		        name="@editItemForm("isApproved").name"
		        >
		        	<option value="1" @if(editItemForm("isApproved").value=="true"){selected}>Approved</option>
		        	<option value="0" @if(editItemForm("isApproved").value=="false"){selected}>Pending</option>
		      </select>
		      
		      <span class="help-block">@{editItemForm("isApproved").error.map { error => error.message }}</span>
		    </div>
		  </div>
	    	
	    	<div class="form-group">
		    <label class="col-sm-3 control-label" for="picture">Picture</label>
		    <div class="col-sm-9">
		      @if(imagePath != null && imagePath.length() > 0){
		      	<img class="col-md-12 item-image" src="@routes.Assets.at("images/inventory-images/" + imagePath)"/>
		      	
		      	<div class="col-md-12">
		      		<hr/>
		      		<button type="button" id="remove-button" class="btn btn-danger">Remove Image</button>
		      		<button type="button" class="btn btn-default" data-toggle="modal" data-target="#image-modal">Open Full Image</button>
		      		<hr/>
		      	</div>
		      	
		      }else{
		      	<i>No picture</i>
		      }
		      
		      <input type="file" id="picture" name="picture" data-max-size='4m' accept="image/*" />
		      <span class="help-block">Upload a picture. 4MB max size(optional)</span>
		      <input type="text" hidden id="image-path" name="imagePath" readonly value="@imagePath">
		    </div>
		  </div>
	    	
	    	
       	<button type="submit" class="btn-default btn btn-primary pull-right">Update Item</button>
       	
       	<a href="@routes.AdminController.deleteItem(tagId)" onclick="return confirm('Are you sure you want to delete this item? This cannot be undone.')" class="btn-default btn btn-danger pull-right">Delete Item</a>
       	
        </div>
        <div class="row col-md-6 text-center log-container">
        <h2>Log History</h2>
        <hr/>
		    @Html(logText)
		</div>
	
	</div>			
	
		<div class="modal fade full-width-modal" id="image-modal" tabindex="-1" role="dialog" 
		   aria-labelledby="myModalLabel" aria-hidden="true">
		   <div class="modal-dialog">
		      <div class="modal-content">
		         <div class="modal-header">
		            <button type="button" class="close" 
		               data-dismiss="modal" aria-hidden="true">
		                  &times;
		            </button>
		            <h4 class="modal-title" id="myModalLabel">
		              Item Image
		            </h4>
		         </div>
		         <div class="modal-body text-center">
		            <img src="@routes.Assets.at("images/inventory-images/" + imagePath)" />
		         </div>
		         <div class="modal-footer">
		         </shr>
		         	<button type="button" class="btn btn-default" 
			               data-dismiss="modal">Close
			            </button>
		         </div>
		      </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->	
	}
	<script src="@routes.Assets.at("javascripts/file-validator.js")" type="text/javascript"></script>
	<script type="text/javascript">
	jQuery(document).ready(function() {
		  jQuery(".categories").select2();
		  jQuery(".departments").select2();
		  jQuery( "input[type=file]" ).fileValidator({
			  onValidation: function(files){      $(this).attr('class','');          },
			  onInvalid:    function(type, file){ 
				  					$(this).addClass('invalid '+type); 
			  						jQuery("form").on("submit",function(){
			  							alert("File size is too big. Please use an image lesser than MB");
			  							return false;
			  						})
	  						},
			  maxSize:      '4m',
			  type:         'image' //optional
			});
		  
		  jQuery("#remove-button").click(function(){
			  jQuery("img.item-image").hide();
			  jQuery("#image-path").val("");
		  });
			
		});
	</script>
	 
}