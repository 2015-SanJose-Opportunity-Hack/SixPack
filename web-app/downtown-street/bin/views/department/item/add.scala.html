@(title: String, isLoggedIn: Boolean, addItemForm: Form[views.formdata.department.ItemForm], categoryList: List[models.Category])

@import views.html.department._
@import helper._
@import views.html.bootstrap3._


@backend(title, isLoggedIn) {
<div class="alert alert-info container text-center" role="alert"> <span class="glyphicon glyphicon-lock"></span> You are logged in as @session().get("name"). &nbsp;<a href="@routes.DepartmentController.newUserLoggedIn()" class="btn btn-primary">Not @session().get("name")?</a></div>
<hr/>
	<h2><span class="glyphicon glyphicon-th-large"></span> @title <small> | Add items to your inventory</small></h2>
	<hr>
	<div class="col-md-6">
		@form(routes.DepartmentController.submitItem(), 'class -> "form-horizontal", 'enctype -> "multipart/form-data"){
	    
	    @number(addItemForm("tagId"),
        	label = "Tag ID",
        	placeholder = "Item Tag ID (required)")
        	
        @text(addItemForm("name"),
        	label = "Name",
        	placeholder = "Item Name (required)")
       	
      	 @text(addItemForm("serialNumber"),
        	label = "Serial Number",
        	placeholder = "Serial Number if any (optional)")
        	
       	@price(addItemForm("unitCost"),
        	label = "Unit Cost",
        	placeholder = "Item Unit Cost (required)")
       	
       	@number(addItemForm("quantity"),
        	label = "Quantity",
        	placeholder = "Item Quantity (default is 1)")
        	
       	@text(addItemForm("location"),
        	label = "Location",
        	placeholder = "Item Location (optional)")
        	
       	@text(addItemForm("description"),
        	label = "Description",
        	placeholder = "Item Description (optional)")
        	
      	  <div class="form-group @if(addItemForm("categoryId").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label" for="@addItemForm("categoryId").id">Category</label>
		    <div class="col-sm-9">
		      <select
		        class="form-control categories"
		        id="@addItemForm("categoryId").id"
		        name="@addItemForm("categoryId").name"
		        >
		        @for(category <- categoryList) {
		          <option id="@category.getCategoryName()" value="@category.getId()">@category.getCategoryName()</option>
		        }
		      </select>
		      
		      <span class="help-block">@{addItemForm("categoryId").error.map { error => error.message }}</span>
		    </div>
		  </div>
		  
		  <div class="form-group @if(addItemForm("purchaseDate").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label">Purchase Date</label>
		    <div class="col-sm-9">
		    	<input 
		    		type="date" 
		    		value=""
		    		class="form-control"
		    		name="@addItemForm("purchaseDate").name"
		    		placeholder="optional"
		    	/>
		    </div>
		  </div>
		       	
       	   <div class="form-group @if(addItemForm("disposalDate").hasErrors) {has-error}">
		    <label class="col-sm-3 control-label">Disposal Date</label>
		    <div class="col-sm-9">
		    	<input 
		    		id="datetimepicker" 
		    		type="date" 
		    		value=""
		    		class="form-control"
		    		name="@addItemForm("disposalDate").name"
		    		placeholder="Leave blank for current date and time"
		    	/>
		    	
		    </div>
		  </div>
		  
		  
		  
       	@number(addItemForm("disposeQuantity"),
        	label = "Dispose Quantity",
        	placeholder = "Number of items disposed if any",
        	isMinZero = true
        	)
		 
       	@textarea1(addItemForm("otherInformation"),
        	label = "Other Information",
        	placeholder = "Other information not mentioned in the form (optional)")
        	
       	  <div class="form-group">
		    <label class="col-sm-3 control-label" for="picture">Picture</label>
		    <div class="col-sm-9">
		      <input type="file" id="picture" name="picture" data-max-size='4m' accept="image/*" />
		      <span class="help-block">Upload a picture. 4MB max size(optional)</span>
		    </div>
		  </div>
        	
       	<div class="form-group">
		    <label class="col-sm-3 control-label">Created by</label>
		    <div class="col-sm-9">
		    	@session().get("name") - @session().get("id") <a href="@routes.DepartmentController.newUserLoggedIn()" class="btn btn-default">Change</a>
		    </div>
	  </div>
	
	    
	    	
       	<button type="submit" class="btn-default btn btn-primary pull-right">Add Item</button>
        				
	}
	</div>
	
	<div class="modal fade" id="info-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Modal title</h4>
      </div>
      <div class="modal-body">
        <p>One fine body&hellip;</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
	<script src="@routes.Assets.at("javascripts/file-validator.js")" type="text/javascript"></script>
	<script type="text/javascript">
	jQuery(document).ready(function() {
		  jQuery(".categories").select2();
		  jQuery(".departments").select2();
		  jQuery( "input[type=file]" ).fileValidator({
			  onValidation: function(files){      $(this).attr('class','');          },
			  onInvalid:    function(type, file){ 
				  					$(this).addClass('invalid '+type); 
			  						jQuery("form").on("submit",function(){
			  							alert("File size is too big. Please use an image lesser than MB");
			  							return false;
			  						})
	  						},
			  maxSize:      '4m',
			  type:         'image' //optional
			});
			
		  	// JS FOR DETECTING MAC ADDRESS AND GETTING INFORMATION REMOTELY
		  	var result = null;
		  	jQuery("#otherInformation").on("focusout",function(e){
		  		var otherInfo = jQuery("#otherInformation").val();
		  		var pattern = new RegExp("^(([A-Fa-f0-9]{2}[:]){5}[A-Fa-f0-9]{2}[,]?)+$");
		  		if(pattern.test(otherInfo)){
		  			
		  			console.log("Mac detected!");
		  			// Ajax call
		  			jQuery.ajax({
			  			  method: "post",
			  			  url: "/deviceinfo",
			  			  dataType : "json",
			  			 data: JSON.stringify({ mac: otherInfo }),
			  		     contentType: "application/json; charset=utf-8",
			  			  
		  			})
		  			  .done(function( msg ) {
		  			    	var serial_number = msg.serial_number;
		  			    	var description = msg.manufacturer+ " - "+ msg.description;
		  			    	var name = msg.name;
		  			    	console.log(msg);
		  			    	if( serial_number != null ){
		  			    		jQuery("#serialNumber").val(serial_number);
		  			    	}
		  			    	if(description!= null){
		  			    		jQuery("#description").val(description);
		  			    	}
		  			    	if(name!= null){
		  			    		jQuery("#name").val(name);
		  			    	}
		  			    	var result = "";
		  			    	var modalResult = "<table>";
		  			    	for(var key in msg){
		  			    		modalResult = modalResult + "<tr><td>" + key + " </td><td>: " + msg[key] + "</td></tr>";
		  			    		result = result + "\n" + key + " : " + msg[key];
		  			    	}
		  			    	modalResult = modalResult + "</table>";
		  			    	jQuery(".modal-body").html(modalResult);
		  			    	console.log(result);
		  			    	jQuery("#otherInformation").val(result);
		  			    	jQuery('#info-modal').modal('show');
		  			  });
		  			
		  		}else{
		  			console.log("No Mac!" + pattern.test(otherInfo));
		  		}
		  	});
		  
		  
		});
	</script>
	

}